@page "/{ViewRoute}/create"
@using Appointment.Globals.Enums

@inherits DynamicBaseView

<PageTitle>Crear</PageTitle>

<RadzenStack Orientation="@Orientation.Horizontal" JustifyContent="@JustifyContent.End">
    <RadzenButton Disabled="@IsBusy" Variant="Variant.Flat" Text="Cancelar" ButtonStyle="ButtonStyle.Warning" />
    <RadzenButton form="@FormId" ButtonType="ButtonType.Submit" Variant="Variant.Flat" Text="Guardar" ButtonStyle="ButtonStyle.Primary" IsBusy=@IsBusy />
</RadzenStack>

<EditForm id="@FormId" 
    OnValidSubmit="@HandleValidSubmit"
    OnInvalidSubmit="@HandleInvalidSubmit" 
    EditContext="@EditFormContext">

    <CascadingValue Value="@this">
        @Module.GetForm(ViewType.Create)
    </CascadingValue>

</EditForm>

@code
{
    protected override void OnInitialized()
    {
        InitView();

        base.OnInitialized();
    }

    private void InitView()
    {
        ViewIsReady = true;
        LastViewRoute = ViewRoute;
        RouteIsValid = ApiService.EndPointIsSaved(ViewRoute);

        if(RouteIsValid)
        {
            SearchModule();
        }

        SetEntity();
    }

    protected override void OnParametersSet()
    {
        if(ViewRoute != LastViewRoute)
        {
            InitView();
            StateHasChanged();
        }

        base.OnParametersSet();
    }
}